{"version":3,"sources":["../../src/commands/ds-compile.ts"],"sourcesContent":["import { spawnSync } from 'child_process';\n\nimport { Command } from '@oclif/core';\n\nimport { ENV, Env } from '@newrade/core-css-extractor';\nimport { getShellForPlatform, loadDotEnv } from '@newrade/core-node-utils';\n\nimport { debugInstance, enableDebug, NS } from '../utilities/log.utilities.js';\n\nexport default class CssExtract extends Command {\n  log = debugInstance(`${NS}:css-extract`);\n  logWarn = debugInstance(`${NS}:css-extract:warn`);\n  logError = debugInstance(`${NS}:css-extract:error`);\n\n  static description =\n    'Compile figma tokens (from figma-sync) into {Color} objects compatible with core-design-system';\n\n  static examples = [`$ nr ds-compile`];\n\n  static args = [];\n\n  static flags = {};\n\n  async run() {\n    enableDebug();\n    this.log(`loading .env in ${process.cwd()}`);\n\n    const env = loadDotEnv<ENV>({\n      schema: Env,\n      dotEnvPath: '.env',\n      packageName: 'core-cli',\n    });\n\n    this.log(`CSS_COMPILE_ENTRIES_GLOB: ${env.CSS_EXTRACTOR_ENTRIES_GLOB}`);\n    this.log(`CSS_COMPILE_OUTPUT_PATH: ${env.CSS_EXTRACTOR_OUTPUT_PATH}`);\n\n    const { args, flags } = await this.parse(CssExtract);\n\n    const command = `cross-env TS_NODE_PROJECT=../../tsconfig.node-cli.json node -r ts-node/register ../../node_modules/webpack/bin/webpack --config ../core-css-extractor/webpack.prod.config.ts`;\n\n    this.log(`running: ${command}`);\n\n    const cmd = spawnSync(command, {\n      shell: getShellForPlatform(),\n      stdio: ['inherit', 'inherit', 'pipe'],\n      env: process.env,\n    });\n\n    if (cmd.stderr && cmd.stderr.toString().length) {\n      const stderr = cmd.stderr.toString();\n      if (/error/gi.test(stderr)) {\n        this.logError(`${stderr}`);\n        throw new Error(stderr);\n      }\n      this.log(`${stderr}`);\n    }\n\n    this.log(`finished`);\n  }\n}\n"],"names":["CssExtract","Command","log","debugInstance","NS","logWarn","logError","description","examples","args","flags","run","enableDebug","process","cwd","env","loadDotEnv","schema","Env","dotEnvPath","packageName","CSS_EXTRACTOR_ENTRIES_GLOB","CSS_EXTRACTOR_OUTPUT_PATH","parse","command","cmd","spawnSync","shell","getShellForPlatform","stdio","stderr","toString","length","test","Error"],"mappings":"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"}