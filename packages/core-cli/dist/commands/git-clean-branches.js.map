{"version":3,"sources":["../../src/commands/git-clean-branches.ts"],"sourcesContent":["import { Command, Flags } from '@oclif/core';\nimport chalk from 'chalk';\nimport debug from 'debug';\nimport simpleGit from 'simple-git';\n\nimport { NS } from '../utilities/log.utilities.js';\n\nexport default class GitCleanBranches extends Command {\n  log = debug(`${NS}:git-clean-branches`);\n  logWarn = debug(`${NS}:git-clean-branches:warn`);\n  logError = debug(`${NS}:git-clean-branches:error`);\n\n  static description = 'delete local branches that are already merged on origin';\n\n  static examples = [`$ nr git-clean-branches`];\n\n  static flags = {\n    help: Flags.help({ char: 'h' }),\n  };\n\n  static args = [];\n\n  async init() {}\n\n  async run() {\n    const git = simpleGit();\n\n    this.log('looking for local branches to remove');\n\n    const localBranches = await git.branchLocal();\n    this.log(`local branches: ${localBranches.all.map((branch) => chalk.blueBright(branch))}`);\n\n    const ignoredBranches = ['dev', 'master', 'release'];\n    this.log(`ignored: ${ignoredBranches.map((branch) => chalk.blueBright(branch))}`);\n\n    const mergedToMasterBranches = await git.branch(['--merged', 'master']);\n    this.log(`branches merged on master: ${mergedToMasterBranches.all}`);\n\n    const localBranchesToBeDeleted = localBranches.all\n      .filter((localBranch) => mergedToMasterBranches.all.includes(localBranch))\n      .filter((branch) => !ignoredBranches.includes(branch));\n    this.log(\n      `to remove: ${\n        localBranchesToBeDeleted.length\n          ? localBranchesToBeDeleted.map((branch) => chalk.red(branch))\n          : '[]'\n      }`\n    );\n\n    if (!localBranchesToBeDeleted.length) {\n      this.log(`no branches to remove âœ…`);\n      return;\n    }\n\n    localBranchesToBeDeleted.map(async (branchToRemove) => {\n      this.log(`removing ${branchToRemove}`);\n      const removed = await git.branch([`-d`, branchToRemove]);\n    });\n  }\n}\n"],"names":["GitCleanBranches","Command","log","debug","NS","logWarn","logError","description","examples","flags","help","Flags","char","args","init","run","git","simpleGit","localBranches","branchLocal","all","map","branch","chalk","blueBright","ignoredBranches","mergedToMasterBranches","localBranchesToBeDeleted","filter","localBranch","includes","length","red","branchToRemove","removed"],"mappings":"AAAA;;;;;AAA+B,IAAA,KAAa,WAAb,aAAa,CAAA;AAC1B,IAAA,MAAO,kCAAP,OAAO,EAAA;AACP,IAAA,MAAO,kCAAP,OAAO,EAAA;AACH,IAAA,UAAY,kCAAZ,YAAY,EAAA;AAEf,IAAA,eAA+B,WAA/B,+BAA+B,CAAA;AAEnC,MAAMA,gBAAgB,SAASC,KAAO,QAAA;IACnDC,GAAG,GAAGC,CAAAA,GAAAA,MAAK,AAA4B,CAAA,QAA5B,CAAC,CAAC,EAAEC,eAAE,GAAA,CAAC,mBAAmB,CAAC,CAAC,CAAC;IACxCC,OAAO,GAAGF,CAAAA,GAAAA,MAAK,AAAiC,CAAA,QAAjC,CAAC,CAAC,EAAEC,eAAE,GAAA,CAAC,wBAAwB,CAAC,CAAC,CAAC;IACjDE,QAAQ,GAAGH,CAAAA,GAAAA,MAAK,AAAkC,CAAA,QAAlC,CAAC,CAAC,EAAEC,eAAE,GAAA,CAAC,yBAAyB,CAAC,CAAC,CAAC;IAEnD,OAAOG,WAAW,GAAG,yDAAyD,CAAC;IAE/E,OAAOC,QAAQ,GAAG;QAAC,CAAC,uBAAuB,CAAC;KAAC,CAAC;IAE9C,OAAOC,KAAK,GAAG;QACbC,IAAI,EAAEC,KAAK,MAAA,CAACD,IAAI,CAAC;YAAEE,IAAI,EAAE,GAAG;SAAE,CAAC;KAChC,CAAC;IAEF,OAAOC,IAAI,GAAG,EAAE,CAAC;IAEjB,MAAMC,IAAI,GAAG,EAAE;IAEf,MAAMC,GAAG,GAAG;QACV,MAAMC,GAAG,GAAGC,CAAAA,GAAAA,UAAS,AAAE,CAAA,QAAF,EAAE,AAAC;QAExB,IAAI,CAACf,GAAG,CAAC,sCAAsC,CAAC,CAAC;QAEjD,MAAMgB,aAAa,GAAG,MAAMF,GAAG,CAACG,WAAW,EAAE,AAAC;QAC9C,IAAI,CAACjB,GAAG,CAAC,CAAC,gBAAgB,EAAEgB,aAAa,CAACE,GAAG,CAACC,GAAG,CAAC,CAACC,MAAM,GAAKC,MAAK,QAAA,CAACC,UAAU,CAACF,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QAE3F,MAAMG,eAAe,GAAG;YAAC,KAAK;YAAE,QAAQ;YAAE,SAAS;SAAC,AAAC;QACrD,IAAI,CAACvB,GAAG,CAAC,CAAC,SAAS,EAAEuB,eAAe,CAACJ,GAAG,CAAC,CAACC,MAAM,GAAKC,MAAK,QAAA,CAACC,UAAU,CAACF,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QAElF,MAAMI,sBAAsB,GAAG,MAAMV,GAAG,CAACM,MAAM,CAAC;YAAC,UAAU;YAAE,QAAQ;SAAC,CAAC,AAAC;QACxE,IAAI,CAACpB,GAAG,CAAC,CAAC,2BAA2B,EAAEwB,sBAAsB,CAACN,GAAG,CAAC,CAAC,CAAC,CAAC;QAErE,MAAMO,wBAAwB,GAAGT,aAAa,CAACE,GAAG,CAC/CQ,MAAM,CAAC,CAACC,WAAW,GAAKH,sBAAsB,CAACN,GAAG,CAACU,QAAQ,CAACD,WAAW,CAAC,CAAC,CACzED,MAAM,CAAC,CAACN,MAAM,GAAK,CAACG,eAAe,CAACK,QAAQ,CAACR,MAAM,CAAC,CAAC,AAAC;QACzD,IAAI,CAACpB,GAAG,CACN,CAAC,WAAW,EACVyB,wBAAwB,CAACI,MAAM,GAC3BJ,wBAAwB,CAACN,GAAG,CAAC,CAACC,MAAM,GAAKC,MAAK,QAAA,CAACS,GAAG,CAACV,MAAM,CAAC,CAAC,GAC3D,IAAI,CACT,CAAC,CACH,CAAC;QAEF,IAAI,CAACK,wBAAwB,CAACI,MAAM,EAAE;YACpC,IAAI,CAAC7B,GAAG,CAAC,CAAC,yBAAuB,CAAC,CAAC,CAAC;YACpC,OAAO;SACR;QAEDyB,wBAAwB,CAACN,GAAG,CAAC,OAAOY,cAAc,GAAK;YACrD,IAAI,CAAC/B,GAAG,CAAC,CAAC,SAAS,EAAE+B,cAAc,CAAC,CAAC,CAAC,CAAC;YACvC,MAAMC,OAAO,GAAG,MAAMlB,GAAG,CAACM,MAAM,CAAC;gBAAC,CAAC,EAAE,CAAC;gBAAEW,cAAc;aAAC,CAAC,AAAC;SAC1D,CAAC,CAAC;KACJ;CACF;kBApDoBjC,gBAAgB"}