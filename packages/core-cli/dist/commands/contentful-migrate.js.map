{"version":3,"sources":["../../src/commands/contentful-migrate.ts"],"sourcesContent":["import path from 'path';\n\nimport { Command, Flags } from '@oclif/core';\nimport { runMigration } from 'contentful-migration';\nimport debug from 'debug';\nimport * as t from 'io-ts';\n\nimport { loadDotEnv } from '@newrade/core-node-utils';\n\nimport { enableDebug, NS } from '../utilities/log.utilities.js';\n\n// import packageJson from '../../package.json'; // TODO: check if possible to load local package json\n\nexport const Env = t.intersection([\n  t.partial({\n    /**\n     * Figma\n     */\n    FIGMA_TOKEN: t.string,\n    FIGMA_FILE: t.string,\n  }),\n  t.type({\n    /**\n     * Contentful variables\n     */\n    CONTENTFUL_MIGRATION_FILE: t.string,\n    CONTENTFUL_SPACEID: t.string,\n    CONTENTFUL_MANAGEMENT_TOKEN: t.string,\n    CONTENTFUL_ENV: t.string,\n  }),\n]);\n\nexport type ENV = t.TypeOf<typeof Env>;\n\nexport default class ContentfulMigrate extends Command {\n  log = debug(`${NS}:contentful`);\n  logWarn = debug(`${NS}:contentful:warn`);\n  logError = debug(`${NS}:contentful:error`);\n\n  static description = 'execute migration with the contentful CLI ';\n\n  static examples = [`$ nr figma-sync`];\n\n  static flags = {\n    help: Flags.help({ char: 'h' }),\n  };\n\n  static args = [{ name: 'file', description: 'figma file id' }];\n\n  async run() {\n    enableDebug();\n\n    const env = loadDotEnv<ENV>({\n      schema: Env,\n      dotEnvPath: '.env',\n      packageName: 'core-cli',\n      printEnvVariables: true,\n    });\n\n    /**\n     * @see https://github.com/contentful/contentful-migration\n     */\n    runMigration({\n      filePath: path.resolve(process.cwd(), env.CONTENTFUL_MIGRATION_FILE),\n      environmentId: env.CONTENTFUL_ENV,\n      spaceId: env.CONTENTFUL_SPACEID,\n      accessToken: env.CONTENTFUL_MANAGEMENT_TOKEN,\n    })\n      .then(() => console.log('Migration Done!'))\n      .catch((e) => console.error(e));\n  }\n}\n"],"names":["t","ContentfulMigrate","Command","log","debug","NS","logWarn","logError","description","examples","flags","help","Flags","char","args","name","run","enableDebug","env","loadDotEnv","schema","Env","dotEnvPath","packageName","printEnvVariables","runMigration","filePath","path","resolve","process","cwd","CONTENTFUL_MIGRATION_FILE","environmentId","CONTENTFUL_ENV","spaceId","CONTENTFUL_SPACEID","accessToken","CONTENTFUL_MANAGEMENT_TOKEN","then","console","catch","e","error","intersection","partial","FIGMA_TOKEN","string","FIGMA_FILE","type"],"mappings":"AAAA;;;;;AAAiB,IAAA,KAAM,kCAAN,MAAM,EAAA;AAEQ,IAAA,KAAa,WAAb,aAAa,CAAA;AACf,IAAA,oBAAsB,WAAtB,sBAAsB,CAAA;AACjC,IAAA,MAAO,kCAAP,OAAO,EAAA;AACbA,IAAAA,CAAC,mCAAM,OAAO,EAAb;AAEc,IAAA,cAA0B,WAA1B,0BAA0B,CAAA;AAErB,IAAA,eAA+B,WAA/B,+BAA+B,CAAA;AAyBhD,MAAMC,iBAAiB,SAASC,KAAO,QAAA;IACpDC,GAAG,GAAGC,CAAAA,GAAAA,MAAK,AAAoB,CAAA,QAApB,CAAC,CAAC,EAAEC,eAAE,GAAA,CAAC,WAAW,CAAC,CAAC,CAAC;IAChCC,OAAO,GAAGF,CAAAA,GAAAA,MAAK,AAAyB,CAAA,QAAzB,CAAC,CAAC,EAAEC,eAAE,GAAA,CAAC,gBAAgB,CAAC,CAAC,CAAC;IACzCE,QAAQ,GAAGH,CAAAA,GAAAA,MAAK,AAA0B,CAAA,QAA1B,CAAC,CAAC,EAAEC,eAAE,GAAA,CAAC,iBAAiB,CAAC,CAAC,CAAC;IAE3C,OAAOG,WAAW,GAAG,4CAA4C,CAAC;IAElE,OAAOC,QAAQ,GAAG;QAAC,CAAC,eAAe,CAAC;KAAC,CAAC;IAEtC,OAAOC,KAAK,GAAG;QACbC,IAAI,EAAEC,KAAK,MAAA,CAACD,IAAI,CAAC;YAAEE,IAAI,EAAE,GAAG;SAAE,CAAC;KAChC,CAAC;IAEF,OAAOC,IAAI,GAAG;QAAC;YAAEC,IAAI,EAAE,MAAM;YAAEP,WAAW,EAAE,eAAe;SAAE;KAAC,CAAC;IAE/D,MAAMQ,GAAG,GAAG;QACVC,CAAAA,GAAAA,eAAW,AAAE,CAAA,YAAF,EAAE,CAAC;QAEd,MAAMC,GAAG,GAAGC,CAAAA,GAAAA,cAAU,AAKpB,CAAA,WALoB,CAAM;YAC1BC,MAAM,EAAEC,GAAG;YACXC,UAAU,EAAE,MAAM;YAClBC,WAAW,EAAE,UAAU;YACvBC,iBAAiB,EAAE,IAAI;SACxB,CAAC,AAAC;QAEH;;OAEG,CACHC,CAAAA,GAAAA,oBAAY,AAKV,CAAA,aALU,CAAC;YACXC,QAAQ,EAAEC,KAAI,QAAA,CAACC,OAAO,CAACC,OAAO,CAACC,GAAG,EAAE,EAAEZ,GAAG,CAACa,yBAAyB,CAAC;YACpEC,aAAa,EAAEd,GAAG,CAACe,cAAc;YACjCC,OAAO,EAAEhB,GAAG,CAACiB,kBAAkB;YAC/BC,WAAW,EAAElB,GAAG,CAACmB,2BAA2B;SAC7C,CAAC,CACCC,IAAI,CAAC,IAAMC,OAAO,CAACpC,GAAG,CAAC,iBAAiB,CAAC,CAAC,CAC1CqC,KAAK,CAAC,CAACC,CAAC,GAAKF,OAAO,CAACG,KAAK,CAACD,CAAC,CAAC,CAAC,CAAC;KACnC;CACF;kBArCoBxC,iBAAiB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AArB/B,MAAMoB,GAAG,GAAGrB,CAAC,CAAC2C,YAAY,CAAC;IAChC3C,CAAC,CAAC4C,OAAO,CAAC;QACR;;OAEG,CACHC,WAAW,EAAE7C,CAAC,CAAC8C,MAAM;QACrBC,UAAU,EAAE/C,CAAC,CAAC8C,MAAM;KACrB,CAAC;IACF9C,CAAC,CAACgD,IAAI,CAAC;QACL;;OAEG,CACHjB,yBAAyB,EAAE/B,CAAC,CAAC8C,MAAM;QACnCX,kBAAkB,EAAEnC,CAAC,CAAC8C,MAAM;QAC5BT,2BAA2B,EAAErC,CAAC,CAAC8C,MAAM;QACrCb,cAAc,EAAEjC,CAAC,CAAC8C,MAAM;KACzB,CAAC;CACH,CAAC,AAAC;QAjBUzB,GAAG,GAAHA,GAAG"}